<html lang="en">
<!-- I could avoid a LOT of trouble just using Flask here. I can directly throw variables into the HTML with Flask, while vanilla FastAPI
     is more for when the frontend and backend are separate. I'm either using the wrong tool for the job or I'm not educated enough on my tools, likely the latter.-->
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water!</title>
</head>

<body>
    <script>
        function loadAPI() {
            var request = new XMLHttpRequest();
            request.open("GET", "http://127.0.0.1:8000/supply", true); //Learn more about JS. There should be a way to contact the API which is on the same physical device that is hosting the html but different port, without doing this. Store the ip some other way
            request.addEventListener("load", updatestats);
            request.send();
        }
        function updatestats() {
            var apiStats = JSON.parse(this.responseText); 
            document.getElementById("stats").innerHTML = apiStats.supply + " liters for " + apiStats.weight + " pounds of people will last " + apiStats.days + " days"}
        
        function updateValues(toEdit, byAmount) {
            fetch("http://127.0.0.1:8000/edit", {method: 'POST', 
            headers: {
                    'Accept': 'application/json, text/plain, */*',
                    'Content-Type': 'application/json'
                    },
            body: JSON.stringify({type: toEdit, increment: byAmount})})   
        }
            window.onload = loadAPI()
    </script>

    <div class="topbar">
        <a class="currentPage" href="index.html">Stats</a>
        <a href="calculate.html">Calculator</a>
    </div>

    <noscript>You need JS to use this!</noscript>
    <p class="warning">This is still being worked on. Any numbers that cause a division by 0 will require you to remake the DB!</p>

    <p id="stats" style="text-align: center; font-size: x-large;"><b> x liters</b> for <b>y pounds</b> of people will last <b>z days</b> </p>

    <form id="literchange" style="text-align: center;" action="/editliters/" method="POST">
        Change the liter amount here: <br>
        <input type="number" min="0" id="litercount">
        <a class="greenbtn" onclick="updateValues('liter',document.getElementById('litercount').value);">Use</a>
    </form>

    <form id="poundschange" style="text-align: center;">
        Change the weight in pounds here: <br>
        <input type="number" id="poundcount">
        <a class="greenbtn" onclick="updateValues('weight',document.getElementById('poundcount').value);">Use</a>
    </form>
</body>
</html>